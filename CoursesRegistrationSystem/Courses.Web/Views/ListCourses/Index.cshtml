@{
    ViewBag.Title = "Index";
}

@Styles.Render("~/Content/css")

<h2>Index</h2>

<div id="courses-container">
    <h2>Available Courses</h2>
    <div id="available-courses-container">
        @Html.Action("GetAvailableCourses")
    </div>

    <h2>Registered Courses</h2>
    <div id="registered-courses-container">
        @Html.Action("GetRegisteredCourses")
    </div>
</div>

<script src="~/Scripts/jquery-2.1.4.js"></script>
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script>

    $('.register-course-button').off().on('click', function (event) {
        var token = $('#token').attr('value');
        var data = $(event.target).attr('data-course-id');

        var data = JSON.stringify({
            courseId: data
        });

        $.ajax({
            url: '/ListCourses/RegisterToCourse',
            type: 'POST',
            headers: { 'RequestVerificationToken': token },
            data: data,
            contentType: 'application/json',
            dataType: 'html',
            async: true
        }).done(function (result) {
            window.location = window.location.origin + '/ListCourses/Index'
        }).fail(function (response) {
            if (response.status === 400) {
                $('#modal-text').text(response.statusText);
                $('#open-modal').click();
            }
        });
    });

</script>